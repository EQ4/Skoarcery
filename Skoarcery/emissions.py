from datetime import datetime
import sys


class Voice:

    def __init__(self):
        self.language = ""
        self.cmt_char = ""
        self.ext = ""
        self.tab = 0
        self.fd = sys.stdout

    def cmt(self, words):
        pref = self.tabby + self.cmt_char + " "
        x = "\n" + pref
        words = pref + words.replace("\n", x)
        self._emit(words, end="\n")

    def code_raw(self, code):
        self._emit(code, end="")

    def file_header(self, filename, spell):
        self.cmt(box("{filename}{ext} - Generated by {spell} on {date} for {language}".format(
            filename=filename, ext=self.ext, spell=spell, date=str(datetime.now()).split(".")[0], language=self.language), "="))

    def wee_header(self, text):
        self.cmt(box(text))

    def newline(self, n=1):
        for i in range(0, n):
            self._emit("", end="\n")

    def code_line(self, line, end="\n"):
        self._emit(self.tabby + line, end=end)

    @property
    def tabby(self):
        if self.tab == 0:
            return ""

        return ("{:>" + str(self.tab * 4) + "}").format(" ")

    def _emit(self, text, end=""):
        print(text, end=end, file=self.fd)

        if self.fd != sys.stdout:
            print(text, end=end)


def box(text, char="-"):
    n = len(text)

    line = ("{:" + char + ">" + str(n) + "}").format(char)

    return "{line}\n{text}\n{line}".format(line=line, text=text)


SC = Voice()

SC.language = "SuperCollider 3.6"
SC.cmt_char = '//'
SC.ext = ".sc"


PY = Voice()

PY.language = "Python 3.3.2"
PY.cmt_char = '#'
